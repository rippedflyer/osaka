<style>
    .page-heading{
        text-align: center;
    }
</style>

<form id="searchform">
  <p>
    <input
      type="search"
      id="search-input"
      class="form-control"
      name="q"
      value=""
    />
  </p>
</form>
<ul id="filteredResults" class="post-list"></ul>

<script src="{{'/assets/js/search.js' | relative_url }}" type="text/javascript"></script>

<script>
  var sjs = SimpleJekyllSearch({
    searchInput: document.getElementById("searchform"),
    resultsContainer: document.getElementById("filteredResults"),
    json: "{{'/assets/js/posts.json' | relative_url }}",
    templateMiddleware: function (prop, value, template) {
      if (prop === "title" || prop === "excerpt") {
        value = value.replace(/&amp;/g, "&");
      }
      if (prop === "url" ||prop === "image" ) {
        return value;
      }
      if (prop === "tags"){
        tags = value.split(",");
        formatted_tags = ""
        search_url = "{{'/search/' | relative_url}}?q="
        for(var tagname of tags){
          formatted_tags += "<a href='" + search_url + tagname + "'><code class='highlighter-rouge'><nobr>"+tagname+"</nobr></code></a>\n"
        }
        return formatted_tags
      }
      if(prop=="source"){
        if(!value) return ""
        return "<span class='post-meta'><i class='fa fa-external-link' aria-hidden='true'></i> <a href='"+value+"'>Source</a></span>"
      }
      return value.replace(
        new RegExp(document.getElementById("search-input").value, "gi"),
        '<span class="highlight">$&</span>'
      );
    },
    sortMiddleware: function (a, b) {
      aPrio = matchPriority(a.matchedField);
      bPrio = matchPriority(b.matchedField);
      return bPrio - aPrio;
    },
    noResultsText: '',
    resultsText: '',
    searchResultTemplate:
      "<li class='card'>" +
      "<a class='post-link' href='{{site.baseurl}}{url}'>" +
          "<img src='{image}'/>"+
      "</a>" +
      "<div class='content'>" +
        '<h3>' +
            "<a class='post-link' href='{{site.baseurl}}{url}'>{title}</a>" +
        '</h3>' +
      "<span class='post-meta'><i class='fa fa-calendar' aria-hidden='true'></i> {date}</span>" +
      "<span class='post-meta'><i class='fa fa-map' aria-hidden='true'></i> <a href='{{'/search/' | relative_url}}?q={author}'>{author}</a></span>"+
      "{source}"+
      "<ul class='tag-container'>{tags}</ul>"+
      "</div>" +
      "</li>",
  });

  function matchPriority(fieldMatched) {
    switch (fieldMatched) {
      case "tags":
        return 5;
      case "title":
        return 4;
      case "excerpt":
        return 3;
      default:
        return 0;
    }
  }

  window.addEventListener(
    "load",
    function () {
      var searchParam = new URLSearchParams(window.location.search).get("q");
      if (searchParam != null) {
        document.getElementById("search-input").value = searchParam;
        setTimeout(() => {
          sjs.search(searchParam);
        }, 100);
      }
      document.getElementById("search-input").placeholder =
        "Search";
    },
    false
  );
</script>