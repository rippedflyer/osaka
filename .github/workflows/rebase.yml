name: rebase

on:
  push:
    branches: ['main']

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  rebase:
    runs-on: [ ubuntu-latest ]

    concurrency:
      group: "rebase-deploy"
      cancel-in-progress: false

    steps:
      - name: git-rebase
        uses: tiacsys/git-rebase@v1
        with:
          repo: "https://${{ github.actor }}:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git"
          source_branch: "deploy"
          destination_branch: "main"
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger deploy.yml
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'jekyll.yml', // or workflow file name
              ref: 'deploy', // IMPORTANT: this is the branch with the workflow file
              inputs: {
                branch: 'deploy' // optional input if needed
              }
            });
